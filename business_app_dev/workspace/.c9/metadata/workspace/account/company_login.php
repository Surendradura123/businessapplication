{"changed":true,"filter":false,"title":"company_login.php","tooltip":"/account/company_login.php","value":"<?php \n// Create connection\n    $servername = getenv('IP');\n    $username = getenv('C9_USER');\n    $password = \"\";\n    $database = \"hybrid\";\n    $dbport = 3306;\n\n    // Create connection\n    $db = new mysqli($servername, $username, $password, $database, $dbport);\n    // Check connection\n    if ($db->connect_error) {\n        //die('Could not connect: ' . mysql_error());\n        header( 'Location: ../error.html' ) ;\n    }\n    \n    \n\nif(count($_POST)>0){//Check if there are variables passed in $ _POST\n    $email              = !empty($_POST ['email']) ? $_POST['email'] : \"\";\n    $entered_password   = !empty($_POST['entered_password']) ? $_POST['entered_password'] : \"\";\n    \n    // @ref: https://gist.github.com/odan/138dbd41a0c5ef43cbf529b03d814d7c \n    $key    = '3sc3RLrpd17'; /* random */\n    $method = 'aes-256-cbc';\n    $iv     = chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0);\n    \n    $enc_entered_password = base64_encode(openssl_encrypt($entered_password , $method, $key, OPENSSL_RAW_DATA, $iv));\n\n\n    \n    \n        /* Field Required */\n    $aFieldRequired = [\n        $email,\n        $entered_password\n    ];\n    /* End */\n\n    /* Check Filled Fields */\n    $bFieldRequired = false;\n    foreach($aFieldRequired as $aField){\n        if(trim($aField) == \"\"){\n            $bFieldRequired = true;\n            break;\n        }\n    \n    $query2 = \"SELECT * FROM Company WHERE rep_email = '$email'\";\n    $result2 = $db->query($query2);\n    $row2 = $result2->fetch_assoc(); /* These lines query the dataabse when user enters email */\n\n\n    $company_id     = $row2[\"company_id\"];\n    $name           = $row2[\"name\"];\n    $address1       = $row2[\"address1\"];\n    $address2       = $row2[\"address2\"];\n    $city           = $row2[\"city\"];\n    $eircode        = $row2[\"eircode\"];\n    $rep_first_name = $row2[\"rep_first_name\"];\n    $rep_last_name  = $row2[\"rep_last_name\"];\n    $rep_phone      = $row2[\"rep_phone\"];\n    $user_type_id   = $row2[\"user_type_id\"];\n    $password_enc   = $row2['password_enc'];\n    $created_on     = $row2[\"created_on\"];\n    $ip_address     = $row2[\"ip_address\"];\n    \n        \n        if($enc_entered_password == $password_enc){\n        \n            $correct_password=\"\";\n            $company_name   = $name;\n            $address        = $address1.\",<br>\".$address2.\",<br>\".$city.\",<br>\".$eircode;\n            $comp_id        = $company_id;\n            $rep_name       = $rep_first_name.\" \".$rep_last_name;\n            $trun_phone     = \"******\".substr($rep_phone, 6);\n\n            if($user_type_id = \"\"){\n                $user_type_name = \"\";\n            }\n            else if($user_type_id = \"1\"){\n                $user_type_name = \"Customer\";\n            }\n            else if ($user_type_id = \"2\"){\n                $user_type_name = \"Company\";\n            }\n            else if ($user_type_id = \"3\"){\n                $user_type_name = \"Admin\";\n            }\n            else{\n                $user_type_name = NULL;\n            }\n            \n            $user_type      = $user_type_id.\" - (\".$user_type_name.\")\";\n            $converted_date = date(\"l, j F, Y - G:i:s (T)\",strtotime($created_on)); //converts MySQL time to readable time -  @ref: http://php.net/manual/en/function.date.php\n            $ip_add         = $ip_address;\n            \n            // @ref: https://www.w3schools.com/php/php_cookies.asp\n            $cookie_name = \"user\"; \n            $cookie_value = $customer_id . \" - \". $email;\n            setcookie($cookie_name, $cookie_value, time() + (2592000), \"/\"); // 86400 = 1 day, 2592000 = 30 days\n            \n            \n        \n        }\n        else{\n            $correct_password=\"<font color='red'>Your email address and/or password is not valid</font>\";\n            setcookie(\"\", \"\", time() - 3600);\n        }\n        $successDB = true;\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Hybrid - Customer Login</title>\n    \n    <script src= ../js/javascript.js></script>\n    <!-- <script>\n        var phone_home_edit = \"\";\n        var phone_home = document.getElementById('phone_home');\n        phone_home = phone_home.toString().slice(-4) + '****';\n        phone_home_edit = phone_home;\n    </script> -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.0.2/sha.js\"></script>\n    <script>\n        /*function mySubmit(obj) {\n          var pwdObj = document.getElementById('password2');\n          var hashObj = new jsSHA(\"SHA-512\", \"TEXT\", {numRounds: 1});\n          hashObj.update(pwdObj.value);\n          var hash = hashObj.getHash(\"HEX\");\n          pwdObj.value = hash;\n        }*/\n    </script>\n</head>\n\n<body>\n      <a href=\"/\">Main Index</a>&nbsp;-&nbsp;<a href=\"../user_register_login/index.html\">Section Index</a>\n\n<center>\n<div>\n\n    <table>\n        <tr>\n            <td colspan=\"2\">\n                <center>\n                    <h2>Register</h2>\n                    \n                </center>\n            </td>\n            <td>\n            </td>\n        </tr>\n        <br><br>\n        <tr>\n            <td>\n            </td>\n            <td>\n                <center>\n                    <h2>Login to your account</h2> <!-- Form validation: @ref: https://www.w3schools.com/tags/att_input_pattern.asp -->\n                    <form action=\"\" method=\"post\">\n                        <p>\n                            <label for=\"email\">Your Email:</label>\n                            <input type=\"text\" name=\"email\" id=\"email\" pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,3}$\" title=\"Please ensure your email address is valid. Example: email@address.com\" required><font color=\"red\"><sup>*</sup></font>\n                        </p>\n                        <p>\n                            <label for=\"entered_password\">Enter Password</label>\n                            <input type=\"password\" name=\"entered_password\" id=\"entered_password\" pattern=\"(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}\" title=\"Please enter the password you previously registered with\" required><font color=\"red\"><sup>*</sup></font> <!-- type is 'text' for testing only -->\n                        </p>\n                        </p>\n                            <?php echo ($correct_password) ?>\n                        </p>\n                        <p>\n                            <input type=\"submit\" value=\"Submit\">\n                        </p>\n                    </form>\n                    <?php\n                    \n                    /*if(!isset($bFieldRequired)){\n                        echo (\"\");\n                    }\n                    else if(isset($bFieldRequired) && $bFieldRequired){\n                        echo (\"<font color='red'>Required fields not completed</font>\");\n                    }\n                    else if (isset($successDB) && !$successDB){\n                        echo (\"<font color='red'>Sorry, an error occured. We are aware of this issue and working to fix it. <br><br> Technical information: \".$db->error.\"</font>\");\n                        //header( 'Location: ../../error.html' ) ;\n                    }\n                    else if (isset($successDB) && $successDB){\n                        echo (\"<font color='#3eb740'>Thank you. You are logged in</font>\");\n                    }*/\n                    ?>\n                    <br><br>\n                    <table>\n                    <tr>\n                        <td colspan=\"2\">\n                            <h4><b><u>Your Details:</b></u></h4>\n                        </td>\n\n                    </tr>\n                    <tr>\n                        <td>\n                            <h4>Company Name:</h4>\n                        </td>\n                        <td>\n                            <?php echo ($company_name)?>\n                        </td>\n                    </tr>\n                     <tr>\n                        <td>\n                            <h4>Address:</h4>\n                        </td>\n                        <td>\n                            <?php echo ($address)?>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <h4>Company ID:</h4>\n                        </td>\n                        <td>\n                           <?php echo ($comp_id)?>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>                            \n                            <h4>Rep's Name</h4>\n                        </td>\n                        <td>\n                            <?php echo ($rep_name)?>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <h4>Rep's Phone Number</h4>\n                        </td>\n                        <td>\n                            <?php echo ($trun_phone)?>\n                        </td>\n                    </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <h4>Account created on:</h4>\n                        </td>\n                        <td>\n                            <?php echo ($converted_date)?>\n                        </td>\n                    </td>\n                    </tr>\n                    <tr>\n                        <td>\n                            <h4>Account created with IP:</h4>\n                        </td>\n                        <td>\n                            <?php echo ($ip_add)?>\n                        </td>\n                    </td>\n                    </tr>\n\n                </table>\n                    \n                    \n                    \n                    \n                    \n                    \n                    \n                    <?php\n                    /*if(!isset($bFieldRequired)){\n                        echo (\"\");\n                    }\n                    else if(isset($bFieldRequired) && $bFieldRequired){\n                        echo (\"Required fields not completed\");\n                    }\n                    else if (isset($successDB) && !$successDB){\n                        echo (\"Sorry, an error occured. We are aware of this issue and working to fix it. <br><br> Technical information: \".$db->error);\n                        //header( 'Location: ../../error.html' ) ;\n                    }\n                    else if (isset($successDB) && $successDB){\n                        echo (\"Thank you. You're account needs to be activated. Please check your email<br><br><small>An email would be sent to the user, and the link would send them here: <a href='../user_register_login/create_password.php'>/user_register_login/create_password.php</a>.<br />In this demonstration, this is not active</small>\");\n                    }*/\n                    ?>\n                \n\n                </center>\n            </td>\n        </tr>\n    </table>\n</div>\n\n</body>\n</html>\n ","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":29,"column":0},"end":{"row":29,"column":9},"action":"remove","lines":["    /* */"],"id":2}]]},"ace":{"folds":[],"scrolltop":60,"scrollleft":0,"selection":{"start":{"row":29,"column":0},"end":{"row":29,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":3,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1528893278518}